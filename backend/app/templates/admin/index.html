{% extends "base.html" %}

{% block content %}
<div class="theme-layout">
  <section class="theme-gallery">
    <div class="theme-gallery__header">
      <span class="theme-eyebrow">主题预览</span>
      <h2 class="theme-gallery__title">选择你的管理后台风格</h2>
      <p class="theme-gallery__description">
        登录、短链与子域管理界面提供多种视觉主题。下方卡片支持实时预览与一键切换，帮助团队匹配不同品牌调性或活动氛围。
      </p>
    </div>
    <div class="theme-gallery__grid">
      <article
        class="theme-preview-card"
        data-theme-option="aurora"
        tabindex="0"
        role="button"
        aria-label="切换至 Aurora Glow 亮色主题预览"
      >
        <div class="theme-preview-card__header">
          <span class="theme-preview-card__title">Aurora Glow</span>
          <span class="theme-preview-card__tag">亮色 · 渐变玻璃</span>
        </div>
        <div class="theme-preview-card__canvas">
          <div class="theme-preview-surface theme-preview-surface--login">
            <div class="theme-preview-label theme-preview-label--wide"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-button-row">
              <div class="theme-preview-button"></div>
            </div>
          </div>
          <div class="theme-preview-surface">
            <div class="theme-preview-label"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-label theme-preview-label--narrow"></div>
            <div class="theme-preview-button-row">
              <div class="theme-preview-button"></div>
              <div class="theme-preview-button theme-preview-button--ghost"></div>
            </div>
          </div>
        </div>
        <div class="theme-preview-card__actions">
          <button type="button" class="theme-button theme-button--solid" data-theme-apply="aurora">
            使用亮色主题
          </button>
          <p>清爽的渐变与柔和高光适合日间使用的运营后台，兼顾品牌展示与高对比度表单体验。</p>
        </div>
      </article>
      <article
        class="theme-preview-card"
        data-theme-option="nebula"
        tabindex="0"
        role="button"
        aria-label="切换至 Nebula Pulse 暗色主题预览"
      >
        <div class="theme-preview-card__header">
          <span class="theme-preview-card__title">Nebula Pulse</span>
          <span class="theme-preview-card__tag">暗色 · 霓虹宇宙</span>
        </div>
        <div class="theme-preview-card__canvas">
          <div class="theme-preview-surface theme-preview-surface--login">
            <div class="theme-preview-label theme-preview-label--wide"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-button-row">
              <div class="theme-preview-button"></div>
            </div>
          </div>
          <div class="theme-preview-surface">
            <div class="theme-preview-label"></div>
            <div class="theme-preview-input"></div>
            <div class="theme-preview-label theme-preview-label--narrow"></div>
            <div class="theme-preview-button-row">
              <div class="theme-preview-button"></div>
              <div class="theme-preview-button theme-preview-button--ghost"></div>
            </div>
          </div>
        </div>
        <div class="theme-preview-card__actions">
          <button type="button" class="theme-button theme-button--solid" data-theme-apply="nebula">
            使用暗色主题
          </button>
          <p>沉浸式暗色和霓虹脉冲降低夜间眩光，适合开发者和需要长时间专注操作的管理团队。</p>
        </div>
      </article>
    </div>
  </section>

  <section class="theme-shell">
    <div class="theme-shell__banner">
      <div class="theme-tagline">
        管理后台的所有表单均直接调用 <code>/api/*</code> 接口，请按接口契约填写字段；若提交失败会返回后端原始错误信息，便于快速排查。
      </div>
    </div>
    <nav class="theme-tabs" aria-label="Sections">
      <a
        href="?tab=links"
        class="theme-tab {% if active_tab == 'links' %}is-active{% endif %}"
      >
        <span class="theme-tab__dot"></span>
        短链 (
        <span
          id="short-link-count"
          hx-get="/admin/links/count"
          hx-trigger="load, refresh-links from:body"
          hx-swap="outerHTML"
        >
          {{ short_links|length }}
        </span>
        )
      </a>
      <a
        href="?tab=subdomains"
        class="theme-tab {% if active_tab == 'subdomains' %}is-active{% endif %}"
      >
        <span class="theme-tab__dot"></span>
        子域 (
        {% with count=subdomains|length %}
        {% include "admin/partials/subdomain_count.html" %}
        {% endwith %}
        )
      </a>
    </nav>
    <div class="theme-shell__body">
      {% if active_tab == 'links' %}
      <div class="theme-stack">
        <section class="theme-card">
          <div class="theme-card__header">
            <h2 class="theme-card__title">创建短链</h2>
            <p class="theme-card__subtitle">
              填写目标地址，可按需调整短链后缀；前缀 {{ short_link_prefix }} 已固定展示，提交后表格会自动刷新。
            </p>
          </div>
          <div class="theme-card__body">
            <form
              class="theme-form"
              action="/api/links"
              method="post"
              hx-post="/api/links"
              hx-trigger="submit"
              hx-target="#link-feedback"
              hx-swap="innerHTML"
              data-reset-on-success="true"
              data-success-event="refresh-links"
            >
              <div class="theme-form__grid theme-form__grid--two">
                <div class="theme-field">
                  <label for="code" class="theme-label">短链（可改）</label>
                  <div class="theme-input-affix">
                    <span class="theme-input-affix__addon theme-input-affix__addon--prefix">{{ short_link_prefix }}</span>
                    <input
                      id="code"
                      name="code"
                      type="text"
                      class="theme-input-affix__input"
                      value="{{ short_code_suggestion or '' }}"
                      data-random-code="true"
                      data-random-code-length="{{ short_code_length }}"
                      autocomplete="off"
                      spellcheck="false"
                      placeholder="自动生成，可修改"
                    />
                  </div>
                </div>
                <div class="theme-field theme-form__span-full">
                  <label for="target_url" class="theme-label">目标地址 *</label>
                  <input
                    id="target_url"
                    name="target_url"
                    type="url"
                    required
                    class="theme-input"
                    placeholder="https://example.com/path"
                  />
                </div>
              </div>
              <div class="theme-form__footer">
                <p class="theme-helper">
                  表单直接调用 <code>POST /api/links</code>，默认提供随机短链编码，可在提交前调整。
                </p>
                <button type="submit" class="theme-button theme-button--solid">
                  保存短链
                </button>
              </div>
            </form>
          </div>
          <div
            id="link-feedback"
            class="theme-feedback"
            role="status"
            aria-live="polite"
          ></div>
        </section>
        <section class="theme-card">
          <div class="theme-card__header">
            <h2 class="theme-card__title">短链列表</h2>
            <p class="theme-card__subtitle">
              查看短链、跳转目标与访问次数，可直接复制、编辑或删除。
            </p>
          </div>
          <div
            id="links-table"
            class="theme-card__body theme-card__body--table"
            hx-get="/admin/links/table"
            hx-trigger="load, refresh-links from:body"
            hx-swap="innerHTML"
          >
            {% include "admin/partials/link_table.html" %}
          </div>
        </section>
      </div>
      {% else %}
      <div class="theme-stack">
        <section class="theme-card">
          <div class="theme-card__header">
            <h2 class="theme-card__title">创建子域</h2>
            <p class="theme-card__subtitle">
              填写子域前缀即可，后缀 .{{ base_domain }} 将自动拼接；状态码默认为 302，支持在下拉菜单中切换。
            </p>
          </div>
          <div class="theme-card__body">
            <form
              class="theme-form"
              action="/api/subdomains"
              method="post"
              hx-post="/api/subdomains"
              hx-trigger="submit"
              hx-target="#subdomain-feedback"
              hx-swap="innerHTML"
              data-reset-on-success="true"
              data-success-event="refresh-subdomains"
            >
              <div class="theme-form__grid theme-form__grid--three">
                <div class="theme-field">
                  <label for="subdomain-prefix" class="theme-label">子域 *</label>
                  <div
                    class="theme-input-affix"
                    data-domain-input
                    data-domain-suffix="{{ base_domain }}"
                  >
                    <input
                      id="subdomain-prefix"
                      type="text"
                      required
                      class="theme-input-affix__input"
                      placeholder="如 marketing"
                      autocomplete="off"
                      spellcheck="false"
                      data-domain-input-field
                    />
                    <span class="theme-input-affix__addon theme-input-affix__addon--suffix">.{{ base_domain }}</span>
                    <input type="hidden" name="host" data-domain-input-hidden />
                  </div>
                </div>
                <div class="theme-field">
                  <label for="subdomain-code" class="theme-label">状态码</label>
                  <select id="subdomain-code" name="code" class="theme-select">
                    {% for option in subdomain_code_options %}
                    <option value="{{ option }}" {% if option == 302 %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="theme-field theme-form__span-full">
                  <label for="target_url" class="theme-label">目标地址 *</label>
                  <input
                    id="target_url"
                    name="target_url"
                    type="url"
                    required
                    class="theme-input"
                    placeholder="https://example.com"
                  />
                </div>
              </div>
              <div class="theme-form__footer">
                <p class="theme-helper">
                  表单调用 <code>POST /api/subdomains</code>，子域前缀会自动补全为 .{{ base_domain }} 的完整域名。
                </p>
                <button type="submit" class="theme-button theme-button--solid">
                  保存子域
                </button>
              </div>
            </form>
          </div>
          <div
            id="subdomain-feedback"
            class="theme-feedback"
            role="status"
            aria-live="polite"
          ></div>
        </section>
        <section class="theme-card">
          <div class="theme-card__header">
            <h2 class="theme-card__title">子域列表</h2>
            <p class="theme-card__subtitle">
              快速查看子域、跳转目标与状态码，可直接复制链接、删除或进入编辑。
            </p>
          </div>
          <div
            id="subdomains-table"
            class="theme-card__body theme-card__body--table"
            hx-get="/admin/subdomains/table"
            hx-trigger="load, refresh-subdomains from:body"
            hx-swap="innerHTML"
          >
            {% include "admin/partials/subdomain_table.html" %}
          </div>
        </section>
      </div>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
