# Yetla Nginx 配置示例：根据子域名路由到不同的 upstream。

# 定义静态 upstream。生产环境可改为指向真实服务或容器。
upstream app_api {
    server app_api:80;
}

upstream app_console {
    server app_console:80;
}

upstream app_default {
    server app_default:80;
}

# 通过 map 指令将 Host 头映射到对应的 upstream。
map $host $target_upstream {
    default app_default;
    ~^api\.yet\.la$ app_api;
    ~^console\.yet\.la$ app_console;
}

# 主服务器块捕获所有 yet.la 的子域请求。
server {
    listen 80;
    server_name .yet.la yet.la;

    # 对静态站点的示例跳转，可根据需求选择 301/302。
    if ($host = console.yet.la) {
        return 302 https://console.yet.la$request_uri;
    }

    location / {
        proxy_pass http://$target_upstream;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 可选：为根域提供静态兜底页面
    location @fallback_static {
        root /usr/share/nginx/html;
        try_files /index.html =404;
    }
}
